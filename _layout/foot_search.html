<script src="/libs/fuzzysort@2.0.4/fuzzysort.min.js"></script>
<script>
const $ = document.querySelector.bind(document)

function shorten(inputString) {
  // Split the input string into lines
  const lines = inputString.split(/\r?\n/);

  // Get the first line and the first 50 characters of the string
  const firstLine = lines[0];
  const first50Characters = inputString.substring(0, 200);

  // Compare the lengths of the first line and the first 50 characters
  if (firstLine.length < first50Characters.length) {
    return firstLine;
  } else {
    return first50Characters;
  }
}

function f(x) {
  const hl = fuzzysort.highlight
  const style = "style=\"font-size: 70%\""
  return `<div>${x[0]?hl(x[0]):x.obj.title}<p ${style}>${shorten(x[1]?hl(x[1]):x.obj.content)}</p></div><br/>`
}

function search(query, documents) {
  options = {
    keys:['title', 'content'],
    scoreFn: a => Math.max(a[0]?a[0].score:-Infinity, a[1]?a[1].score-100:-Infinity),
    all: true,
    threshold: -10000,
  }
  const results = fuzzysort.go(query, documents, options)
  $('#results-div').innerHTML = results.reduce((acc,x) => acc+f(x), "")
}
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", search("", mystuff))
} else {
  search("", mystuff)
}

</script>
